# 执行上下文
- 什么是执行上下文

  执行JavaScript代码环境的抽象概念。每当JavaScript代码执行时，都是在执行上下文中运行。

- 执行上下文类型

  |  类型   |   |
  |  ----  | ---- |
  | 全局执行上下文 | 任何不在函数内部的代码都在全局上下文中。 <br>创建一个全局的window对象（浏览器），并设置this的值等于这个全局对象。<br>一个程序中只有一个全局执行上下文。 |
  | 函数执行上下文 |  每当一个函数<kbd>**被调用**</kbd>的时候，都会为该函数创建一个新的执行上下文。<br>每个函数都有他自己的执行上下文。<br>每当一个新的执行上下文被创建，它会按定义的顺序执行一系列步骤。 |
  | Eval执行上下文 | 执行在 eval 函数内部的代码也会有它属于自己的执行上下文。 |
     
- 执行栈

  一种拥有“后进先出”的数据结构的栈，用来存储所有代码执行时产生的执行上下文。
  
  当JavaScript引擎第一次执行脚本，先会创建一个全局执行上下文压入当前执行栈。每当遇到一个函数调用，它会创建一个函数执行上下文并压入栈的顶部。
  
  ```
    ExectionContextStack = []
    ExectionContextStack.push(GlobalExecutionContext) // 首次执行JavaScript脚本, 创建全局执行上下文并压入当前执行栈
    ExectionContextStack.push(<Func>ExecutionContext) // 每次遇到函数调用，都会创建一个函数执行上下文并压入当前栈
  ```
  
  JavaScript引擎会优先执行执行上下文位于栈顶的函数。当函数执行结束，执行上下文从栈中弹出，控制流程到当前栈中的下一个执行上下文。
  
- 如何创建执行上下文

  创建执行上下文有两个阶段：1) **创建阶段** 和 2) **执行阶段**。

  | 创建阶段发生的事情 |
  | ------- |
  | 1.**this**值的绑定<br>2.创建**词法环境**组件<br>3.创建**变量环境**组件 |
  
  
  代码表示：
  ```javascript
    ExectionContext = {
      thisBinding = this,  // this绑定
      LexicalEnvironment = { ... }, // 词法环境
      VariableEnvironment = { ... } // 变量环境
    }
  ```

